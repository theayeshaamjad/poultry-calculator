<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Poultry Shed-wise Dose Calculator</title>
<style>
 body{font-family:Arial, sans-serif;background:#f5f7fa;margin:20px;}
 h1{text-align:center;font-size:2.5em;color:#222;text-decoration:underline;margin-bottom:4px;}
 h2{text-align:center;font-size:1.5em;font-style:italic;font-weight:bold;margin-top:0;margin-bottom:25px;color:#000;}
 label{display:block;margin-top:10px;font-weight:bold;}
 input[type=text], input[type=number], select{
   width:100%;padding:10px;margin:5px 0 10px;
   border:1px solid #ccc;border-radius:6px;font-size:1em;
   box-sizing:border-box;
 }
 input[type=number]::-webkit-outer-spin-button,
 input[type=number]::-webkit-inner-spin-button {-webkit-appearance: none;margin: 0;}
 input[type=number] { -moz-appearance: textfield; }

 .radio-group{display:flex;gap:20px;margin:8px 0;}
 .radio-group label{font-weight:normal;font-size:1.1em;cursor:pointer;}
 .shed-table{width:100%;border-collapse:collapse;margin-top:15px;}
 .shed-table th,.shed-table td{border:1px solid #bbb;padding:6px;text-align:center;}
 .shed-table th{background:#e1e7ef;}
 button{margin-top:10px;padding:9px 16px;background:#4a90e2;color:#fff;border:none;border-radius:6px;cursor:pointer;}
 button:hover{background:#357bd1;}
 #results{background:#fff;padding:15px;border:1px solid #ccc;border-radius:8px;margin-top:20px;}
 #results h3{margin-top:0;text-align:center;}
 .highlight{background:#dff0d8;font-weight:bold;}
 .small-muted{font-size:0.9em;color:#555;margin-top:6px;}
 @media print{
   body{background:#fff;}
   .no-print{display:none;}
   table{border-collapse:collapse;width:100%;}
   th,td{border:1px solid #000;padding:6px;}
   th{background:#eee;}
   .highlight{background:#dff0d8;font-weight:bold;}
 }
</style>
</head>
<body>
<div class="container">
  <h1>Dr Usman Ali</h1>
  <h2>SHED WISE DOSE CALCULATOR</h2>

  <label>Medicine Name (CAPS):</label>
  <input type="text" id="medicine" style="text-transform:uppercase">

  <label>Type of Medicine:</label>
  <select id="medicineType" onchange="updateCompUnit()">
    <option value="liquid">Liquid</option>
    <option value="powder">Powder</option>
  </select>

  <label>Composition:</label>
  <div id="compGroup" class="radio-group">
    <label><input type="radio" name="compType" value="percent" checked> Percentage (%)</label>
    <label id="gUnitLabel"><input type="radio" name="compType" value="gper"> g/L</label>
  </div>
  <input type="number" id="composition" placeholder="Enter composition" max="100" step="0.01">

  <label>Required Dose (mg per kg body weight):</label>
  <input type="number" id="dose" placeholder="mg/kg" step="0.01">

  <label>Course Duration (days):</label>
  <input type="number" id="duration" placeholder="e.g. 5" step="1" min="1">

  <h3 style="margin-top:25px;">Shed Details</h3>
  <table class="shed-table" id="shedTable">
    <thead>
      <tr>
        <th>Shed No.</th>
        <th>No. of Females</th>
        <th>Avg Female Wt (g)</th>
        <th>No. of Males</th>
        <th>Avg Male Wt (g)</th>
        <th class="no-print">Delete</th>
      </tr>
    </thead>
    <tbody id="shedBody"></tbody>
  </table>
  <button class="no-print" onclick="addRow()">Add Shed</button>

  <div class="no-print" style="margin-top:12px;">
    <button onclick="calculateDose()">Calculate Dose</button>
    <button onclick="printData()">Print</button>
    <button onclick="resetAll()">Reset</button>
  </div>

  <div id="results"></div>

  <div class="small-muted">
    <strong>Brief terms:</strong>
    <ul>
      <li><strong>mg/kg:</strong> milligrams of active ingredient per kilogram bodyweight.</li>
      <li><strong>Composition %:</strong> 1% = 10 mg per mL (liquid) or per g (powder).</li>
      <li><strong>g/L or g/kg:</strong> grams of active per litre or kilogram.</li>
    </ul>
  </div>
</div>

<script>
let shedCount=0;

function updateCompUnit(){
  const type=document.getElementById('medicineType').value;
  const lbl=document.getElementById('gUnitLabel');
  lbl.innerHTML = `<input type="radio" name="compType" value="gper"> ${type==='liquid'?'g/L':'g/Kg'}`;
}

function renumber(){
  const rows=document.querySelectorAll('#shedBody tr');
  rows.forEach((row,i)=>{
    const box=row.querySelector('.shedNo');
    if(document.activeElement!==box){
      box.value=i+1;
    }
  });
}

function addRow(){
  shedCount++;
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input type="number" class="shedNo" value="${shedCount}" style="width:80px"></td>
    <td><input type="number" class="females" min="0"></td>
    <td><input type="number" class="fWeight" min="0"></td>
    <td><input type="number" class="males" min="0"></td>
    <td><input type="number" class="mWeight" min="0"></td>
    <td class="no-print"><button onclick="this.closest('tr').remove();renumber()">X</button></td>`;
  document.getElementById('shedBody').appendChild(tr);

  tr.querySelectorAll('input').forEach(inp=> inp.addEventListener('input',renumber));

  const lastInput = tr.querySelector('.mWeight');
  lastInput.addEventListener('keydown', e => {
    if(e.key === 'Enter'){
      e.preventDefault();
      addRow();
      setTimeout(()=>{
        const rows = document.querySelectorAll('#shedBody tr');
        rows[rows.length-1].querySelector('.females').focus();
      }, 30);
    }
  });
}
addRow();

function calculateDose(){
  const med = document.getElementById('medicine').value.trim().toUpperCase();
  const type = document.getElementById('medicineType').value; // 'liquid' or 'powder'
  const compType = (document.querySelector('input[name="compType"]:checked') || {}).value;
  const composition = parseFloat(document.getElementById('composition').value);
  const dosePerKg = parseFloat(document.getElementById('dose').value);
  const duration = parseFloat(document.getElementById('duration') ? document.getElementById('duration').value || 1 : 1);
  const resultDiv = document.getElementById('results');

  if(!med){ alert('Enter medicine name.'); return; }
  if(isNaN(composition) || composition <= 0){ alert('Enter valid composition (>0).'); return; }
  if(compType === 'percent' && composition > 100){ alert('Percentage composition cannot exceed 100.'); return; }
  if(isNaN(dosePerKg) || dosePerKg <= 0){ alert('Enter valid dose (mg/kg).'); return; }

  // mg of active ingredient per mL or per g
  let mgPerUnit;
  if(compType === 'percent'){
    mgPerUnit = composition * 10; // 1% = 10 mg/mL or mg/g
  } else {
    mgPerUnit = composition; // g/L -> mg/mL  OR  g/kg -> mg/g
  }

  let tableHtml = `<h3>Calculation Results</h3>
    <table style="width:100%;border-collapse:collapse;" border="1">
      <thead><tr>
        <th>Shed</th>
        <th>Flock Weight (kg)</th>
        <th>Daily Units</th>
        <th>Total Course Units</th>
      </tr></thead><tbody>`;

  let overallWeight = 0, overallDailyUnits = 0, overallTotalUnits = 0;

  document.querySelectorAll('#shedBody tr').forEach((row, idx) => {
    const shedNo = row.querySelector('.shedNo').value || (idx+1);
    const nf = parseFloat(row.querySelector('.females').value) || 0;
    const af = parseFloat(row.querySelector('.fWeight').value) || 0;
    const nm = parseFloat(row.querySelector('.males').value) || 0;
    const am = parseFloat(row.querySelector('.mWeight').value) || 0;

    const flockKg = ((nf * af) + (nm * am)) / 1000;
    if(flockKg <= 0) return;

    const totalMgPerDay = dosePerKg * flockKg;
    const dailyUnits = totalMgPerDay / mgPerUnit;
    const totalCourseUnits = dailyUnits * duration;

    overallWeight += flockKg;
    overallDailyUnits += dailyUnits;
    overallTotalUnits += totalCourseUnits;

    const unitLabel = type === 'liquid' ? 'ml' : 'g';
    // âœ… show both small unit and big unit if >1000
    let dailyDisplay = `${dailyUnits.toFixed(2)} ${unitLabel}`;
    let totalDisplay = `${totalCourseUnits.toFixed(2)} ${unitLabel}`;
    if(type === 'liquid' && dailyUnits >= 1000){
      dailyDisplay += ` (${(dailyUnits/1000).toFixed(3)} L)`;
      totalDisplay += ` (${(totalCourseUnits/1000).toFixed(3)} L)`;
    }
    if(type === 'powder' && dailyUnits >= 1000){
      dailyDisplay += ` (${(dailyUnits/1000).toFixed(3)} kg)`;
      totalDisplay += ` (${(totalCourseUnits/1000).toFixed(3)} kg)`;
    }

    tableHtml += `<tr>
      <td>${shedNo}</td>
      <td>${flockKg.toFixed(2)}</td>
      <td class="highlight">${dailyDisplay}</td>
      <td class="highlight">${totalDisplay}</td>
    </tr>`;
  });

  // overall totals with big-unit display
  let overallDaily = `${overallDailyUnits.toFixed(2)} ${type==='liquid'?'ml':'g'}`;
  let overallTotal = `${overallTotalUnits.toFixed(2)} ${type==='liquid'?'ml':'g'}`;
  if(type === 'liquid' && overallDailyUnits >= 1000){
    overallDaily += ` (${(overallDailyUnits/1000).toFixed(3)} L)`;
    overallTotal += ` (${(overallTotalUnits/1000).toFixed(3)} L)`;
  }
  if(type === 'powder' && overallDailyUnits >= 1000){
    overallDaily += ` (${(overallDailyUnits/1000).toFixed(3)} kg)`;
    overallTotal += ` (${(overallTotalUnits/1000).toFixed(3)} kg)`;
  }

  tableHtml += `</tbody></table>
    <div style="margin-top:10px;font-weight:bold;">
      Overall Flocks Weight: ${overallWeight.toFixed(2)} kg<br>
      Overall Daily Units: ${overallDaily}<br>
      Overall Course Units: ${overallTotal}
    </div>`;

  resultDiv.innerHTML = tableHtml;
}


function printData(){
  const w = window.open('', 'PRINT', 'height=900,width=1000');
  w.document.write('<html><head><title>Print</title>');
  w.document.write('<style>');
  w.document.write('body{font-family:Arial;}');
  w.document.write('h1{text-align:center;font-size:2.5em;color:#222;text-decoration:underline;}');
  w.document.write('h2{text-align:center;font-size:1.5em;font-style:italic;font-weight:bold;color:#000;}');
  w.document.write('table{border-collapse:collapse;width:100%}');
  w.document.write('th,td{border:1px solid #000;padding:6px;}');
  w.document.write('th{background:#eee;}');
  w.document.write('.highlight{background:#dff0d8;font-weight:bold;}');
  w.document.write('</style></head><body>');

  // Top headings
  w.document.write('<h1>Dr Usman Ali</h1><h2>SHED WISE DOSE CALCULATOR</h2>');

  // Input summary (medicine/type/composition/dose only)
  const med = document.getElementById('medicine').value.toUpperCase();
  const type = document.getElementById('medicineType').value;
  const compType = (document.querySelector('input[name="compType"]:checked') || {}).value;
  const compVal = document.getElementById('composition').value || '';
  const doseVal = document.getElementById('dose').value || '';
  const compUnit = compType === 'percent' ? '%' : (type === 'liquid' ? 'g/L' : 'g/Kg');
  const duration = document.getElementById('duration') ? document.getElementById('duration').value || '' : '';

  w.document.write('<h3>Input Data</h3>');
  w.document.write('<table><tr><th>Medicine</th><th>Type</th><th>Composition</th><th>Dose (mg/kg)</th><th>Course Duration (days)</th></tr>');
  w.document.write(`<tr><td>${med}</td><td>${type}</td><td>${compVal} ${compUnit}</td><td>${doseVal}</td><td>${duration}</td></tr></table>`);

  // âœ… Results table (unchanged and still printed)
  w.document.write(document.getElementById('results').innerHTML || '<p>No results calculated yet.</p>');

  w.document.write('</body></html>');
  w.document.close();
  w.focus();
  w.print();
}
function resetAll(){
  if(!confirm('Clear all data?')) return;
  document.getElementById('medicine').value='';
  document.getElementById('composition').value='';
  document.getElementById('dose').value='';
  document.getElementById('duration').value='';
  document.getElementById('results').innerHTML='';
  document.getElementById('shedBody').innerHTML='';
  shedCount=0; addRow();
}

document.addEventListener('keydown', e=>{
  if(e.shiftKey && e.key==='Delete'){
    const el=document.activeElement;
    if(el && el.closest && el.closest('tr')){
      el.closest('tr').remove();
      renumber();
    }
  }
});
</script>
</body>
</html>
